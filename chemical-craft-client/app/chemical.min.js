angular.module("chemicalCraftApp",["chemicalCraftApp.controllers"]).directive("chemicalElement",function($rootScope){return{restrict:"E",controller:function($scope,$attrs){$scope.element=$scope.getChemicalElementByPosition($scope.p,$scope.g)},template:'<div id="{{element.Code}}" x-lvl-draggable="true" class="chemical-element {{element.Category}}"><div class="atomic-number"><span>{{element.AtomicNumber}}</span></div><div class="code"><b>{{element.Code}}</b></div><div class="name"><span>{{element.Name}}</span></div></div>'}}).directive("lvlDraggable",["$rootScope",function($rootScope){return{restrict:"A",link:function(scope,el,attrs,controller){angular.element(el).attr("draggable","true");angular.element(el).attr("id");el.bind("dragstart",function(event){event.originalEvent.dataTransfer.setData("Text",event.target.id),$rootScope.$emit("LVL-DRAG-START")}),el.bind("dragend",function(e){$rootScope.$emit("LVL-DRAG-END")})}}}]).directive("lvlDropTarget",["$rootScope",function($rootScope){return{restrict:"A",scope:{onDrop:"&"},link:function(scope,el,attrs,controller){var id=attrs.id;el.bind("dragover",function(e){return e.preventDefault&&e.preventDefault(),e.originalEvent.dataTransfer="move",!1}),el.bind("dragenter",function(e){angular.element(e.target).addClass("lvl-over")}),el.bind("dragleave",function(e){angular.element(e.target).removeClass("lvl-over")}),el.bind("drop",function(e){e.preventDefault&&e.preventDefault(),e.stopPropogation&&e.stopPropogation();var data=e.originalEvent.dataTransfer.getData("text"),dest=document.getElementById(id),src=document.getElementById(data);scope.onDrop({dragEl:src,dropEl:dest})}),$rootScope.$on("LVL-DRAG-START",function(){var el=document.getElementById(id);angular.element(el).addClass("lvl-target")}),$rootScope.$on("LVL-DRAG-END",function(){var el=document.getElementById(id);angular.element(el).removeClass("lvl-target"),angular.element(el).removeClass("lvl-over")})}}}]),angular.module("chemicalCraftApp.controllers",["chemicalCraftApp.services"]).controller("chemicalController",function($scope,chemicalService){"use strict";$scope.crafting=[],$scope.periodicTable=[],chemicalService.getPeriodicTable(function(periodicTable){$scope.periodicTable=periodicTable,$scope.periods=[1,2,3,4,5,6,7],$scope.groups=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]}),$scope.getChemicalElementByPosition=function(period,group){for(var i=0;i<$scope.periodicTable.length;i++)if($scope.periodicTable[i].Period==period&&$scope.periodicTable[i].Group==group)return $scope.periodicTable[i]},$scope.dropped=function(chemicalElement,crafting){var drop=angular.element(chemicalElement),icon=(angular.element(crafting),angular.element('<div class="'+drop.attr("class")+'"><div><b>'+drop.attr("id")+"</b></div></div>"));icon.removeClass("chemical-element"),icon.addClass("chemical-element-icon");for(var i=1;3>=i;i++)for(var j=1;3>=j;j++){var td=angular.element("#td"+i+"-"+j);if(""==td.html())return td.html(icon),void $scope.crafting.push(drop.attr("id"))}}}),angular.module("chemicalCraftApp.services",[]).factory("chemicalService",function($http){"use strict";var service={};return service.getPeriodicTable=function(callback){var httpServiceUrl="http://localhost:3000/chemistry/";$http({url:httpServiceUrl,method:"get",headers:{"Content-Type":"application/json"}}).success(function(data){callback(data)})},service});